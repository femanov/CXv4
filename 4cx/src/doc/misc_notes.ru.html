<HTML>
<HEAD>
<TITLE>Всякие всякости</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="style.css">
</HEAD>
<BODY>

<H1>Всякие всякости про CXv4</H1>


<H2></H2>


<H2>Имена каналов</H2>

<P>В общем случае полное имя канала имеет вид

<BLOCKQUOTE><CODE>PROTOCOL::SERVER:N.CHANNEL_NAME@OPTIONS</CODE></BLOCKQUOTE>

<P>Здесь:

  <DL>

  <DT>PROTOCOL<DD>Название протокола, отделяемое от следующих
компонентов двойным двоеточием.

<P>При неуказанности протокола используется умолчательное из контекста,
а при его неуказанности -- <TT>CX::</TT>.

<P>В настоящее время поддерживаются протоколы <TT>CX::</TT>,
<TT>V2CX::</TT>, <TT>INSRV::</TT> (внутренний протокол для доступа
драйверов к каналам своего сервера), <TT>LOCAL::</TT> (внутренний
протокол для монолитных стендовых программ), <TT>VCAS::</TT>
(недореализован), <TT>EPICS::</TT> (нереализован).

  <DT>SERVER:N<DD>Имя сервера.

<P>Опциональный компонент, в зависимости от протокола.

<P>В CX:: при неуказанности сервера выполняется широковещательный
резолвинг по имени канала. (При ненайденности резолвинг повторяется с
некоторой периодичностью. Кроме тоно, в дальнейшем, при обрыве связи с
сервером, процесс резолвинга повторяется, что позволяет переселять
каналы в другие сервера.)

<P>В VCAS:: является обязательным компонентом.

  <DT>CHANNEL_NAME<DD>Имя канала.

<P>В общем случае может состоять из произвольных символов -- в
зависимости от протокола.

<P>Но рекомендуется не злоупотреблять этим, а по возможности
ограничивать имена теми же символами, что приняты для имён в языке
C/C++ -- латинскими буквами, цифрами и символом подчёркивания
([a-zA-Z_0-9]), разделяя иерархические компоненты имени символом
<TT>'.'</TT>.  Библиотека cda способствует такому использованию,
рассматривая имена каналов аналогично иерархическим именам файлов.

<P>В VCAS:: производится автоматическая трансляция разделителей
<TT>'.'</TT> в нативные для VCAS <TT>'/'</TT>.

  <DT>OPTIONS<DD>Дополнительные опции.

<P>Опциональный компонент, интерпретируемый модулем реализации
конкретного протокола.

  </DL>

<P>Все компоненты имени являются case-insensitive.


<H2>Генерация полных имён каналов в cda</H2>

<P>При использовании библиотеки cda полные имена каналов образуются
сцеплением 3 компонентов: defpfx, base, spec.

  <UL TYPE=square>

  <LI>Компонент defpfx указывается один раз при создании контекста
функцией <CODE>cda_new_context()</CODE>, и затем присоединяется в
начало всех создаваемых в этом контексте каналов.

  <LI>Компоненты base и spec указываются при регистрации канала
функцией <CODE>cda_add_chan()</CODE>.

  </UL>

<P>Такое разделение сделано для удобства работы с многоуровневыми
иерархиями каналов: если использовать аналогию с файловой системой, то
base может считаться именем директории, а spec именем файла в ней
(defpfx же -- root dir).

<P>Конкатенация компонентов выполняется не просто их сцеплением через
<TT>'.'</TT> (аналогично <TT>'/'</TT> в файловой системе), а по
некоторым правилам, позволяющим последующим компонентам менять
местоположение в иерархии относительно предыдущих (аналогично префиксам
<TT>"/"</TT> и <TT>"../"</TT> в файловой системе).

<P>Возможные префиксы:

  <OL>

  <LI><TT>.</TT> (точка)&nbsp;-- переход в корень иерархии (аналог
<TT>'/'</TT>).

<P>При этом игнорируются предыдущие уровни и происходит переход в
корень иерархии сервера.

  <LI><TT>:</TT> (двоеточие)&nbsp;-- переход на один уровень вверх в
иерархии (аналог <TT>'../'</TT>).

<P>При этом игнорируется один предыдущий уровень, если он есть.

  <LI><TT>SERVER:N.</TT>&nbsp;-- переход в другой сервер (в корень его
иерархии).

<P>При этом игнорируются предшествующие компоненты, включая сервер --
оставляется только протокол.

  <LI><TT>PROTOCOL::</TT>&nbsp;-- переход на другой протокол.

<P>При этом игнорируются все предшествующие компоненты.

  </OL>

<P>Полное имя собирается "с конца" -- сначала к name спереди
добавляется base, а затем к ним спереди добавляется defpfx.  Указанные
выше правила используются в обеих точках конкатенации.

<P>Примеры:

<TABLE BORDER=1 CELLSPACING=0>

<TR HALIGN=left><TH>defpfx</TH><TH>base</TH><TH>spec</TH><TH>Результат</TH><TH>Комментарии</TH></TR>

<TR><TD>cx::</TD><TD>hwsrv:1</TD><TD>dev.chan</TD>
<TD>cx::hwsrv:1.dev.chan</TD>

<TD>Классический вариант</TD>
</TR>

<TR><TD>&nbsp;</TD><TD>hwsrv:1</TD><TD>dev.chan</TD>
<TD>cx::hwsrv:1.dev.chan</TD>

<TD>Без указания протокола</TD>
</TR>

<TR><TD>cx::hwsrv:1</TD><TD>&nbsp;</TD><TD>dev.chan</TD>
<TD>cx::hwsrv:1.dev.chan</TD>

<TD>Без использования base</TD>
</TR>

<TR VALIGN=top><TD>cx::hwsrv:1.dev</TD><TD>&nbsp;</TD><TD>chan</TD>
<TD>cx::hwsrv:1.dev.chan</TD>

<TD>База полностью указана в defpfx, включая начальный путь в иерархии</TD>
</TR>

<TR VALIGN=top><TD>&nbsp;</TD><TD>&nbsp;</TD><TD>cx::hwsrv:1.dev.chan</TD>
<TD>cx::hwsrv:1.dev.chan</TD>

<TD>Всё полностью указано в самом spec</TD>
</TR>

<TR><TD>cx::</TD><TD>hwsrv:1.one.two</TD><TD><B>.</B>other_dev.chan</TD>
<TD>cx::hwsrv:1.other_dev.chan</TD>

<TD><TT>'.'</TT> -- переход в корень</TD>
</TR>

<TR><TD>cx::</TD><TD>hwsrv:1.one.two</TD><TD><B>:</B>other.chan</TD>
<TD>cx::hwsrv:1.one.other.chan</TD>

<TD><TT>':'</TT> -- переход уровнем выше</TD>
</TR>

<TR><TD>cx::</TD><TD>hwsrv:1.one.two</TD><TD><B>vacuum:5.</B>some_dev.chan</TD>
<TD>cx::vacuum:5.some_dev.chan</TD>

<TD>Переход в другой сервер</TD>
</TR>

<TR VALIGN=top><TD>cx::</TD><TD>hwsrv:1.one.two</TD><TD><B>vcas::</B>zeus:20041.some.channel</TD>
<TD>vcas::zeus:20041.some.channel</TD>

<TD>Переход на другой протокол.<P>В данном случае VCAS, сервер
zeus:20041, канал some/channel</TD>
</TR>

</TABLE>

<H3>Указание base и defpfx в некоторых прикладных программах</H3>

<P>Defpfx: 

  <UL TYPE=square>

  <LI>у программ

<A HREF="programs/cdaclient.ru.html"><CODE>cdaclient</CODE></A> и

<A HREF="programs/das-experiment.ru.html"><CODE>das-experiment</CODE></A>

можно указать ключом <CODE>-d DEFPFX</CODE>;

  <LI>у

<A HREF="screens.ru.html">"экранов" программ</A> (и программы
<CODE>pult</CODE>) он указывается в директиве <TT>defserver</TT> либо
параметром в командной строке.

  </UL>

<P>Base:

  <UL TYPE=square>

  <LI>у программ

<A HREF="programs/cdaclient.ru.html"><CODE>cdaclient</CODE></A> и

<A HREF="programs/das-experiment.ru.html"><CODE>das-experiment</CODE></A>

можно указать ключом <CODE>-b BASEREF</CODE>;

  <LI>у

<A HREF="screens.ru.html">"экранов" программ</A> (и прочего софта на основе
Cdr) многоуровневая иерархия: база может указываться у каждого контейнерного
элемента, и она конкатенируется с базами предыдущих (в иерархии) контейнеров
по тем же правилам, что spec.

  </UL>


</BODY>
</HTML>
