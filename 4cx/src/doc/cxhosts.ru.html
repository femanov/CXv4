<HTML>
<HEAD>
<TITLE>Файлы cxhosts</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="style.css">
</HEAD>
<BODY>

<H1>Файлы cxhosts</H1>

	<H2>Назначение</H2>

<P>Файлы cxhosts предназначены для управления контролем доступа к
CX-серверу.  С их помощью можно запрещать доступ полностью, разрешать
полностью либо только для чтения (запись запрещается).


	<H2>Расположение</H2>

<P>По умолчанию&nbsp;&#151; без config-файла&nbsp;&#151; сервер cxsd будет
пытаться использовать файл <TT>./.cxhosts</TT>.

<P>Путь может быть указан в config-файле директивой
<CODE>cxhosts-file</CODE>.

<P>В стандартном config-файле <TT>cxsd.conf</TT> указан путь
<TT>configs/cxhosts</TT>; т.е., будет использоваться файл
<TT>~/4pult/configs/cxhosts</TT>.


	<H2>Синтаксис</H2>

<P>Формат файла очень простой: на каждой строке по одному правилу, пустые
строки игнорируются, комментарии, начинающиеся с символа <TT>#</TT>, тоже
игнорируются.

<P>Правила имеют формат

<BLOCKQUOTE><CODE>РЕЖИМ_ДОСТУПА ГРУППА_АДРЕСОВ</CODE></BLOCKQUOTE>

		<H3>Режимы доступа</H3>

<TABLE BORDER=1 CELLSPACING=0 ALIGN=center>

<TR><TH>Режим</TH><TH>Описание</TH></TR>

<TR VALIGN=baseline><TD>deny</TD><TD>Доступ запрещён полностью.</TD></TR>

<TR VALIGN=baseline><TD>allow</TD><TD>Разрешены чтение и запись.</TD></TR>

<TR VALIGN=baseline><TD>readonly</TD><TD>Разрешено только чтение.</TD></TR>

<TR VALIGN=baseline><TD>nolock</TD><TD>Разрешены чтение и запись, но блокировка каналов запрещена.</TD></TR>

</TABLE>

		<H3>Синтаксис указания адресов</H3>

<TABLE BORDER=1 CELLSPACING=0 ALIGN=center>

<TR><TH>Формат</TH><TH>Описание</TH><TH>Пример</TH></TR>

<TR VALIGN=baseline><TD>AAA.BBB.CCC.DDD</TD><TD>Один адрес.</TD><TD>193.124.164.171</TD></TR>

<TR VALIGN=baseline><TD>ADDRESS1-ADDRESS2</TD><TD>Диапазон адресов.</TD><TD>192.168.128.0-192.168.135.255</TD></TR>

<TR VALIGN=baseline><TD>ADDRESS/MASK</TD><TD>Блок адресов по маске (подсеть).</TD><TD>192.168.128.0/255.255.248.0</TD></TR>

<TR VALIGN=baseline><TD>ADDRESS/NN</TD><TD>Блок адресов (подсеть), числом NN
указывается количество битов в адресе сети (для сетей класса C&nbsp;&#151; 24).</TD><TD>192.168.128.0/21</TD></TR>

<TR VALIGN=baseline><TD>local</TD><TD>Идентично "127.0.0.1".</TD></TR>

<TR VALIGN=baseline><TD>all</TD><TD>Идентично "0.0.0.0/0.0.0.0".</TD></TR>

<TR VALIGN=baseline><TD>none</TD><TD>Идентично "255.255.255.255/0.0.0.0".</TD></TR>

</TABLE>

<P>Поддерживаются только адреса IPv4.  Символьные имена&nbsp;&#151; нет.

<P>IP-адреса рассматриваются как 32-битные числа, в формате "первым
указывается старший байт"&nbsp;&#151; т.е., A.B.C.D рассматривается как
A&lt;&lt;24+B&lt;&lt;16+C&lt;&lt;8+D.  Например, адрес 1.2.3.4 считается
числом 0x01020304.


	<H2>Семантика</H2>

		<H3>Чтение файла</H3>

<P>Сервер считывает файл cxhosts при старте, создавая список контроля
доступа в памяти, и затем при обращениях клиентов сверяясь уже с этим
списком в памяти, а к файлу более не обращается.

<P>Повторное считывание файла можно вызвать путём отправки серверу сигнала
<CODE>SIGUSR1</CODE>.

		<H3>Назначение прав доступа</H3>

<P>Сервер производит поиск по списку контроля доступа, определяя права
доступа для данного клиента в момент установления соединения.  В дальнейшем
используются эти права, а повторного поиска по списку не делается.

<P><I>(Т.е., если некий клиент приконнектился, получил некие права, затем
файл cxhosts был модифицирован и перечитан сервером по SIGUSR1, у того
клиента останутся первоначально полученные права, даже если в
модифицированном файле они уже отличаются.)</I>

		<H3>Определение прав доступа</H3>

<P>Поиск по списку идёт последовательно, от начала к концу.  Используется
первая подошедшая строка.

<P>Если режим доступа "<CODE>deny</CODE>" (т.е., право на соединение
отсутствует), то соединение немедленно закрывается с кодом ACCESS_DENIED (по
этому коду клиентская библиотека cda НЕ пытается повторять попытки
соединения).

<P>Также права доступа проверяются модулем UDP-резолвинга имён, и если у
запрашивающего клиента отсутствует право на соединение, то запрос
игнорируется (даже если у сервера в БД имён есть ответ на запрос, клиенту он
отправлен не будет).


</BODY>
</HTML>
