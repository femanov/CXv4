<HTML>
<HEAD>
<TITLE>cdaclient: руководство</TITLE>
<LINK REL="stylesheet" TYPE="text/css" HREF="../style.css">
</HEAD>
<BODY>

<H1>Утилита <CODE>cdaclient</CODE></H1>

	<H2>Введение</H2>

<P>Утилита <CODE>cdaclient</CODE> предназначена для чтения и записи значений
каналов из консоли.

<P>В простейшем варианте она может прочитать или записать значение одного
канала, но есть также много иных вариантов использования:

  <UL TYPE=square>

  <LI>Постоянное мониторирование канала (ключ <CODE>-m</CODE>) либо группы
каналов (в дополнение к <CODE>-m</CODE> полезно также указать
  <CODE>-Dn</CODE>).

  <LI>Получение служебной информации о каналах (ключи <CODE>-DR</CODE>,
<CODE>-Dd</CODE>, <CODE>-DQ</CODE>, <CODE>-DS</CODE>).

  <LI>Сохранение набора значений в файл с возможностью затем восстановить
эти значения ("прочитать режим").

  </UL>


	<H2>Использование</H2>

		<H3>Общий формат вызова</H3>

<BLOCKQUOTE><CODE>cdaclient [КЛЮЧИ] КОМАНДА {КОМАНДА...}</CODE></BLOCKQUOTE>

<P>КОМАНДА это либо просто ИМЯ_КАНАЛА (чтение), либо ИМЯ_КАНАЛА=ЗНАЧЕНИЕ
(запись).

  <UL TYPE=square>

  <LI>После исполнения команды (т.е., после прихода ответа на запрос чтения
либо подтверждения на запрос записи) она считается исполненной и удаляется
из списка.  После исполнения всех команд программа завершает работу.

  <LI>В режиме мониторирования (с ключом <CODE>-m</CODE>) из списка
удаляются только команды записи, а команды чтения остаются "навсегда" и
значения таких каналов печатаются при каждом обновлении данных.

  <LI>Несуществующие каналы -- т.е., те, на которые приходит отрицательный
ответ RSLVSTAT -- удаляются в любом случае.

  </UL>


		<H3>Поддерживаемые ключи</H3>

<TABLE BORDER=0 CELLSPACING=2 ALIGN=center>

<TR VALIGN=baseline><TD><CODE>-1</CODE></TD><TD>НЕ производить расширения
скобок <CODE>{}</CODE> и <CODE>&lt;&gt;</CODE>.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-b BASEREF</CODE></TD><TD>Общий префикс имён
каналов -- base.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-d DEFPFX</CODE></TD><TD>Общий префикс имён
каналов -- defpfx.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-D DISPMODE</CODE></TD><TD>Управление режимом
отображения данных -- набор флагов (подробнее см.

<A HREF="#dispmode">ниже</A>).</TD></TR>

<TR VALIGN=baseline><TD><CODE>-f FILENAME</CODE></TD><TD>Считать список
каналов/команд из указанного файла, по одному на строку.

<P>Подробнее см. ниже в разделе

"<A HREF="#input-file-syntax">Формат входных файлов</A>".</TD></TR>

<TR VALIGN=baseline><TD><CODE>-m</CODE></TD><TD>Режим мониторирования:
продолжать работать и после получения значений всех запрошенных каналов;
каналы, на которые уже пришли ответы, из списка не удаляются.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-o OUTFILE</CODE></TD><TD>Отправить выдачу в
указанный файл вместо stdout.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-T DURATION</CODE></TD><TD>Лимит времени
работы, в секундах.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-h</CODE></TD><TD>Печать краткой справки
(help) и выход.</TD></TR>

<TR VALIGN=baseline><TD><CODE>-hh</CODE></TD><TD>Печать более детальной
справки и выход.</TD></TR>

</TABLE>

		<H3 ID="dispmode">Управление режимом отображения данных</H3>


	<H2 ID="channel-spec-syntax">Синтаксис указания каналов</H2>


	<H2 ID="channel-val-syntax">Синтаксис указания значений</H2>


	<H2 ID="input-file-syntax">Формат входных файлов</H2>

<P>Пустые строки пропускаются.  Строки, начинающиеся с <TT>'#'</TT>,
считаются комментариями и также пропускаются.

<P>Каждая строка должна содержать по одной команде, формат команды совпадает
с форматом в командной строке:

  <UL TYPE=square>

  <LI>Чтение: просто <TT>ИМЯ_КАНАЛА</TT>.

  <LI>Запись:

<TT>ИМЯ_КАНАЛА=ЗНАЧЕНИЕ</TT>

либо

<TT>ИМЯ_КАНАЛА ЗНАЧЕНИЕ</TT>; т.е., значение отделяется от имени
символом <TT>'='</TT> либо пробелами.

  </UL>

<P>Полный допустимый формат имеет вид

<BLOCKQUOTE><TT>@TIME %DPYFMT:@DTYPE:(KNOB_PATH)CHANNEL_NAME VALUE OTHER...</TT></BLOCKQUOTE>

<P>Здесь:

<TABLE BORDER=0 CELLSPACING=2 ALIGN=center>


<TR VALIGN=baseline><TD><TT>@TIME</TT></TD><TD>Время, выдаваемое ключом
<CODE>-DT</CODE>.  Игнорируется.</TD></TR>

<TR VALIGN=baseline><TD><TT>%DPYFMT</TT></TD><TD>Формат вывода; актуален
только для команд чтения.</TD></TR>

<TR VALIGN=baseline><TD><TT>@DTYPE</TT></TD><TD>dtype; выдаётся ключом
<CODE>-Dd</CODE>.</TD></TR>

<TR VALIGN=baseline><TD><TT>(KNOB_PATH)</TT></TD><TD>Префикс имени ручки,
выдаваемый Cdr; игнорируется.</TD></TR>

<TR VALIGN=baseline><TD><TT>CHANNEL_NAME</TT></TD><TD>Собственно имя
канала.</TD></TR>

<TR VALIGN=baseline><TD><TT>VALUE</TT></TD><TD>Собственно
значение.</TD></TR>

<TR VALIGN=baseline><TD><TT>OTHER...</TT></TD><TD>Всё после значения
игнорируется.  Сюда входят timestamp значения (выдаётся по ключу
<CODE>-Dt</CODE>), <TT>&lt;rflags&gt;</TT> (выдаются по ключу
<CODE>-Df</CODE>).</TD></TR>

</TABLE>


<P>Корректное игнорирование <TT>(KNOB_PATH)</TT> позволяет читать файлы,
созданные pult-подобными программами при помощи
<CODE>CdrSaveSubsystemMode()</CODE>.


	<H2>Продвинутые сценарии использования</H2>

<P>Поскольку формат входных файлов совпадает с форматом вывода,
<CODE>cdaclient</CODE> может читать файлы, которые сама создаёт.  Это даёт
функционал сохранения и восстановления режимов.

<HR>

...dataset-save/dataset-restore

<P>Утилита УМЕЕТ ЧИТАТЬ ФАЙЛЫ, КОТОРЫЕ САМА ПИШЕТ.

<P>А ТАКЖЕ Cdr'овские.

</BODY>
</HTML>
